<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>MCOT Multi-Channel Live – Mobile</title>

  <!-- รองรับมือถือ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin:0; padding:0;
      width:100%; height:100%;
      background:#000;
      overflow:hidden;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color:#fff;
    }

    /* วิดีโอเต็มหน้าจอ (เต็ม viewport) */
    #live {
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      background:#000;
      object-fit:contain;
      background-color:#000;
    }

    /* ชั้น Overlay */
    .ov {
      position:fixed;
      inset:0;
      pointer-events:none;
    }
    .ov.hidden { opacity:0; transition:opacity .35s ease; }
    .ov.shown  { opacity:1; transition:opacity .2s ease; }

    /* Badge มุมบนซ้าย: CH + ชื่อช่อง */
    .badges {
      position:absolute;
      top:12px;
      left:12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .pill {
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:rgba(0,0,0,0.65);
      border-radius:999px;
      padding:5px 12px;
      font-weight:600;
      letter-spacing:.3px;
      box-shadow:0 6px 16px rgba(0,0,0,.35);
      pointer-events:auto;
      font-size:13px;
    }
    .pill-small {
      font-size:11px;
      padding:4px 10px;
      opacity:.9;
    }
    .dot-red { color:#ff3b30; }

    /* ป้าย 4K HDR – ใช้สำหรับช่อง 10 */
    .flag-4khdr {
      position: fixed;
      top: 12px;
      right: 12px;
      background: linear-gradient(135deg, #ff3b30, #ff9500);
      color: #fff;
      font-weight: 800;
      font-size: 14px;
      letter-spacing: 0.5px;
      padding: 4px 10px;
      border-radius: 999px;
      box-shadow: 0 6px 16px rgba(0,0,0,.35);
      z-index: 9000;
      pointer-events: none;
      text-shadow: 0 2px 6px rgba(0,0,0,.35);
      display:none;
    }

    /* Center note เช่น Paused, Buffering, Changing channel */
    .center-note {
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.7);
      padding:10px 16px;
      border-radius:12px;
      font-weight:600;
      font-size:14px;
      display:none;
      box-shadow:0 8px 20px rgba(0,0,0,.4);
      text-align:center;
    }
    .center-note.show { display:block; }

    /* รายชื่อช่อง (ด้านบนสำหรับมือถือ / ขวาสำหรับจอใหญ่) */
    .channel-list {
      position:absolute;
      top:52px;
      right:10px;
      width:260px;
      max-height:60vh;
      background:rgba(0,0,0,0.65);
      border-radius:14px;
      padding:8px 8px 10px 10px;
      box-shadow:0 10px 30px rgba(0,0,0,.45);
      overflow:hidden;
      font-size:12px;
    }
    .channel-list-title {
      font-size:12px;
      opacity:.9;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .channel-items {
      max-height:52vh;
      overflow-y:auto;
      padding-right:4px;
    }
    .channel-item {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:5px 6px;
      margin-bottom:2px;
      border-radius:10px;
      font-size:12px;
      opacity:.9;
      pointer-events:auto;
      cursor:pointer;
    }
    .channel-item span.ch-no {
      font-weight:800;
      width:30px;
    }
    .channel-item span.ch-name {
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      padding-right:6px;
    }
    .channel-item span.ch-tag {
      font-size:10px;
      opacity:.8;
    }
    .channel-item.active {
      background:rgba(255,255,255,0.18);
      opacity:1;
    }

    /* แถบช่วยเหลือมุมล่างซ้าย (เดสก์ท็อป) */
    .help-pinned {
      position:fixed;
      left:12px;
      bottom:60px;
      max-width:60vw;
      background:rgba(0,0,0,0.50);
      border-radius:12px;
      padding:8px 10px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      pointer-events:none;
      font-size:12px;
      line-height:1.4;
    }
    .help-title {
      font-weight:700;
      margin-bottom:2px;
    }

    /* ควบคุมด้านล่างสำหรับมือถือ */
    .mobile-controls {
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      padding:8px 10px 10px;
      background:rgba(0,0,0,0.8);
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 -4px 16px rgba(0,0,0,.45);
      pointer-events:auto;
      z-index:9200;
      backdrop-filter:blur(8px);
    }
    .mobile-controls button,
    .mobile-controls select {
      font-size:13px;
      padding:6px 8px;
      border-radius:999px;
      border:none;
      outline:none;
    }
    .mobile-controls button {
      font-weight:600;
      min-width:64px;
      background:#222;
      color:#fff;
    }
    .mobile-controls select {
      flex:1;
      max-width:55%;
      background:#111;
      color:#fff;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .channel-list {
        position:fixed;
        top:52px;
        left:10px;
        right:10px;
        width:auto;
        max-height:38vh;
      }
      .help-pinned {
        display:none;
      }
    }
  </style>
</head>
<body>
  <!-- วิดีโอ Live หลัก -->
  <video id="live" autoplay playsinline controls>
    <source id="liveSource"
            src="https://cdn-live.dltv.ac.th/smil:origin01-dltv-01-adaptive.smil/chunklist_w775643767_b1328000_slth.m3u8"
            type="application/x-mpegURL" />
    อุปกรณ์ของคุณไม่รองรับการเล่นวิดีโอ Streaming
  </video>

  <!-- Overlay -->
  <div id="overlay" class="ov shown">
    <div class="badges">
      <div id="badgeChannel" class="pill">
        <span id="badgeChannelNo">CH1</span>
        <span id="badgeChannelName">DLTV1</span>
      </div>
      <div class="pill pill-small">
        LIVE <span class="dot-red">•</span> Internet TV
      </div>
    </div>

    <!-- รายชื่อช่อง -->
    <div class="channel-list" id="channelList">
      <div class="channel-list-title">
        <span>รายการช่อง (10)</span>
        <span style="font-size:11px;opacity:.8;">แตะเพื่อเปลี่ยนช่อง</span>
      </div>
      <div class="channel-items" id="channelItems"></div>
    </div>

    <!-- ข้อความกลางจอ -->
    <div id="centerNote" class="center-note">Loading...</div>
  </div>

  <!-- ป้าย 4K HDR -->
  <div id="flag4k" class="flag-4khdr" aria-hidden="true">4K HDR</div>

  <!-- แถบช่วยเหลือ (เดสก์ท็อป) -->
  <div class="help-pinned" aria-live="polite">
    <div class="help-title">ควบคุมการรับชม</div>
    <div>
      • คลิกชื่อช่องทางขวาเพื่อเปลี่ยนช่อง<br/>
      • Space / Enter = เล่น/หยุด · ↑/↓ = เลื่อนช่อง
    </div>
  </div>

  <!-- แถบควบคุมสำหรับ Mobile -->
  <div class="mobile-controls" id="mobileControls">
    <button type="button" data-action="prev">CH-</button>
    <button type="button" data-action="play">เล่น/หยุด</button>
    <button type="button" data-action="next">CH+</button>
    <button type="button" data-action="fs">เต็มจอ</button>
    <select id="mobileChannelSelect"></select>
  </div>

  <script>
  (function(){
    // -------------------------------
    // ข้อมูลช่อง 10 ช่อง
    // -------------------------------
    var channels = [
      {
        id:1,
        no:'1',
        name:'DLTV1',
        url:'https://cdn-live.dltv.ac.th/smil:origin01-dltv-01-adaptive.smil/chunklist_w775643767_b1328000_slth.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:2,
        no:'2',
        name:'DLTV2',
        url:'https://cdn-live.dltv.ac.th/smil:origin01-dltv-02-adaptive.smil/chunklist_w1183199600_b1328000_slth.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:3,
        no:'3',
        name:'ททบ.5 HD',
        url:'https://639bc5877c5fe.streamlock.net/tv5hdlive/tv5hdlive/chunklist_w732738065.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:4,
        no:'4',
        name:'Mono29',
        url:'https://monomax-uiripn.cdn.byteark.com/plain/th/1080p/index.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:5,
        no:'5',
        name:'Police TV',
        url:'https://cdn-th-vip.livestreaming.in.th/policetv/policetv/chunklist_w110000995.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:6,
        no:'6',
        name:'RAMA Channel',
        url:'https://ramach.ddns.net/live/ramalive/index.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:7,
        no:'7',
        name:'Thai Parliament TV',
        url:'https://tv-live.tpchannel.org/live/tv_1080p.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:8,
        no:'8',
        name:'BBC Two HD',
        url:'https://streamer.nexyl.uk/69ef899e-8ca9-4537-9f1a-fe8b4216afbb_output_0.m3u8?session=P4nDEufYYEh38atgbxq4wB',
        type:'hls',
        tag:'HD'
      },
      {
        id:9,
        no:'9',
        name:'Fox 11 Los Angeles CA',
        url:'https://radiovid.foxnews.com/hls/live/661547/RADIOVID/index_1328.m3u8',
        type:'hls',
        tag:'HD'
      },
      {
        id:10,
        no:'10',
        name:'4K HDR MCOT Testing Channel',
        url:'https://cdn-edge-webrtc-01.iiptvcdn.com/cdn-dash/stream1/manifest.mpd',
        type:'dash',
        tag:'4K HDR'
      }
    ];

    var currentIndex = 0;
    var overlayVisible = true;
    var hideTimer = null;
    var HIDE_MS = 5000;

    var v           = document.getElementById('live');
    var sourceEl    = document.getElementById('liveSource');
    var overlay     = document.getElementById('overlay');
    var centerNote  = document.getElementById('centerNote');
    var flag4k      = document.getElementById('flag4k');
    var badgeNo     = document.getElementById('badgeChannelNo');
    var badgeName   = document.getElementById('badgeChannelName');
    var channelItemsContainer = document.getElementById('channelItems');
    var mobileControls = document.getElementById('mobileControls');
    var mobileSelect   = document.getElementById('mobileChannelSelect');

    // -------------------
    // Fullscreen helper (ต้องมาจาก user gesture เท่านั้น)
    // -------------------
    var fsRequested = false;
    function tryRequestFullscreen() {
      if (fsRequested) return;
      fsRequested = true;
      try {
        if (v.requestFullscreen) {
          v.requestFullscreen().catch(function(){});
        } else if (v.webkitRequestFullscreen) {     // Safari / บาง Android
          v.webkitRequestFullscreen();
        } else if (v.webkitEnterFullscreen) {       // iOS บางรุ่น
          v.webkitEnterFullscreen();
        } else if (v.msRequestFullscreen) {         // Edge เก่า
          v.msRequestFullscreen();
        }
      } catch(e) {
        // ถ้า browser ไม่ยอม ก็แค่ปล่อยไป (ยังเต็ม viewport อยู่แล้ว)
      }
    }

    // ให้ "tap ครั้งแรก" ที่จอ เป็น trigger fullscreen
    function attachFirstTapFullscreen() {
      function handler() {
        tryRequestFullscreen();
        document.removeEventListener('touchend', handler);
        document.removeEventListener('click', handler);
      }
      document.addEventListener('touchend', handler, { passive: true });
      document.addEventListener('click', handler);
    }

    // -------------------
    // Overlay helper
    // -------------------
    function setOverlay(show){
      overlayVisible = show;
      overlay.classList.toggle('shown', show);
      overlay.classList.toggle('hidden', !show);
    }
    function showOverlayTemp(){
      setOverlay(true);
      clearTimeout(hideTimer);
      hideTimer = setTimeout(function(){ setOverlay(false); }, HIDE_MS);
    }
    function setCenterNote(show, text){
      if (typeof text === 'string') centerNote.textContent = text;
      centerNote.classList.toggle('show', !!show);
    }

    // -------------------
    // จัดการเสียง
    // -------------------
    function ensureAudioReady(){
      try {
        v.muted = false;
        v.volume = Math.max(0, Math.min(1, v.volume || 1.0));
        var at = v.audioTracks;
        if (at && at.length){
          for (var i=0;i<at.length;i++) at[i].enabled = (i===0);
        }
      } catch(e){}
    }

    // -------------------
    // สร้างรายการช่องใน UI
    // -------------------
    function buildChannelListUI(){
      channelItemsContainer.innerHTML = '';

      channels.forEach(function(ch, idx){
        var div = document.createElement('div');
        div.className = 'channel-item' + (idx===currentIndex ? ' active' : '');
        div.setAttribute('data-idx', idx);

        var spanNo = document.createElement('span');
        spanNo.className = 'ch-no';
        spanNo.textContent = ch.no;

        var spanName = document.createElement('span');
        spanName.className = 'ch-name';
        spanName.textContent = ch.name;

        var spanTag = document.createElement('span');
        spanTag.className = 'ch-tag';
        spanTag.textContent = ch.tag || '';

        div.appendChild(spanNo);
        div.appendChild(spanName);
        div.appendChild(spanTag);

        // แตะ / คลิก เลือกช่อง
        div.addEventListener('click', function(){
          var idx = parseInt(this.getAttribute('data-idx'), 10);
          applyChannel(idx);
        });

        channelItemsContainer.appendChild(div);
      });

      // สำหรับ dropdown บน mobile
      mobileSelect.innerHTML = '';
      channels.forEach(function(ch, idx){
        var opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = 'CH' + ch.no + ' - ' + ch.name;
        if (idx === currentIndex) opt.selected = true;
        mobileSelect.appendChild(opt);
      });
    }

    function updateChannelListUI(){
      var items = channelItemsContainer.querySelectorAll('.channel-item');
      items.forEach(function(el, idx){
        el.classList.toggle('active', idx===currentIndex);
      });

      if (mobileSelect && mobileSelect.options.length === channels.length) {
        if (mobileSelect.selectedIndex !== currentIndex) {
          mobileSelect.selectedIndex = currentIndex;
        }
      }
    }

    // -------------------
    // เปลี่ยนช่อง
    // -------------------
    function applyChannel(idx){
      if (idx < 0 || idx >= channels.length) return;
      currentIndex = idx;
      var ch = channels[idx];

      // อัปเดต badge
      badgeNo.textContent   = 'CH' + ch.no;
      badgeName.textContent = ch.name;

      // 4K HDR flag
      if (ch.tag && ch.tag.toUpperCase().indexOf('4K') >= 0){
        flag4k.style.display = 'block';
      } else {
        flag4k.style.display = 'none';
      }

      // เซ็ต source ใหม่
      try {
        setCenterNote(true, 'เปลี่ยนช่อง: CH' + ch.no + ' – ' + ch.name);
        if (sourceEl){
          sourceEl.src = ch.url;
          if (ch.type === 'dash'){
            sourceEl.type = 'application/dash+xml';
          } else {
            sourceEl.type = 'application/x-mpegURL';
          }
          v.load();
        } else {
          v.src = ch.url;
        }
        v.play().catch(function(){});
      } catch(e){}

      updateChannelListUI();
      showOverlayTemp();
    }

    function channelUp(){
      var idx = (currentIndex + 1) % channels.length;
      applyChannel(idx);
    }
    function channelDown(){
      var idx = (currentIndex - 1 + channels.length) % channels.length;
      applyChannel(idx);
    }

    // เล่น/หยุด
    function playPause(){
      if (v.paused){
        v.play().catch(function(){});
        setCenterNote(false);
      } else {
        v.pause();
        setCenterNote(true, 'Paused');
      }
      showOverlayTemp();
    }

    // -------------------
    // Swipe Left/Right เพื่อเปลี่ยนช่อง
    // -------------------
    var touchStartX = null;
    var touchStartY = null;
    var SWIPE_THRESHOLD = 60;      // ต้องลากอย่างน้อย 60px ถึงจะนับเป็น swipe
    var SWIPE_VERTICAL_LIMIT = 80; // ถ้าแกนตั้งเปลี่ยนเยอะเกินไป จะไม่ถือว่าเป็น swipe ซ้าย/ขวา

    function handleTouchStart(e) {
      if (!e.changedTouches || e.changedTouches.length === 0) return;
      var t = e.changedTouches[0];
      touchStartX = t.clientX;
      touchStartY = t.clientY;
    }

    function handleTouchEnd(e) {
      if (touchStartX === null || !e.changedTouches || e.changedTouches.length === 0) return;
      var t = e.changedTouches[0];
      var dx = t.clientX - touchStartX;
      var dy = t.clientY - touchStartY;

      // reset เพื่อไม่ให้มีค่าเก่าค้าง
      touchStartX = null;
      touchStartY = null;

      // ถ้าเลื่อนขึ้นลงเยอะเกินไป ไม่ถือว่าเป็น swipe ซ้าย/ขวา
      if (Math.abs(dy) > SWIPE_VERTICAL_LIMIT) return;

      // ต้องเลื่อนแกนนอนเกิน threshold ถึงจะนับ
      if (Math.abs(dx) < SWIPE_THRESHOLD) return;

      if (dx < 0) {
        // ปัดซ้าย -> ช่องถัดไป
        channelUp();
      } else {
        // ปัดขวา -> ช่องก่อนหน้า
        channelDown();
      }
      showOverlayTemp();
    }

    // -------------------
    // Event วิดีโอ
    // -------------------
    v.addEventListener('loadedmetadata', ensureAudioReady);
    v.addEventListener('loadeddata', ensureAudioReady);
    v.addEventListener('canplay', ensureAudioReady);
    v.addEventListener('play', function(){
      ensureAudioReady();
      setCenterNote(false);
    });
    v.addEventListener('pause', function(){
      setCenterNote(true, 'Paused');
      showOverlayTemp();
    });
    v.addEventListener('waiting', function(){
      setCenterNote(true, 'Buffering...');
      showOverlayTemp();
    });
    v.addEventListener('playing', function(){
      setCenterNote(false);
    });
    v.addEventListener('error', function(){
      try {
        setCenterNote(true, 'Reconnecting...');
        v.load();
        v.play().catch(function(){});
      } catch(_){}
    });

    // -------------------
    // Mobile controls
    // -------------------
    mobileControls.addEventListener('click', function(ev){
      var btn = ev.target.closest('button[data-action]');
      if (!btn) return;
      var act = btn.getAttribute('data-action');
      if (act === 'prev') channelDown();
      else if (act === 'next') channelUp();
      else if (act === 'play') playPause();
      else if (act === 'fs')  tryRequestFullscreen();
    });

    mobileSelect.addEventListener('change', function(){
      var idx = parseInt(mobileSelect.value, 10);
      if (!isNaN(idx)) applyChannel(idx);
    });

    // -------------------
    // Keyboard (สำหรับเปิดบนโน้ตบุ๊ก)
    // -------------------
    document.addEventListener('keydown', function(e){
      // Enter / Space = toggle play
      if (e.key === 'Enter' || e.key === ' '){
        playPause();
        e.preventDefault();
      }
      // ArrowUp/Down เปลี่ยนช่อง
      else if (e.key === 'ArrowUp'){
        channelUp();
        e.preventDefault();
      } else if (e.key === 'ArrowDown'){
        channelDown();
        e.preventDefault();
      }
      // 0–9 เลือกช่องตรง (1–9: ช่อง 1–9, 0: ช่อง 10)
      else if (e.key >= '0' && e.key <= '9'){
        var num = parseInt(e.key,10);
        var targetIdx = -1;
        if (num === 0){
          targetIdx = 9;
        } else {
          targetIdx = num - 1;
        }
        if (targetIdx >= 0 && targetIdx < channels.length){
          applyChannel(targetIdx);
        }
        e.preventDefault();
      }
      // i = toggle overlay
      else if (e.key.toLowerCase() === 'i'){
        setOverlay(!overlayVisible);
        if (overlayVisible) showOverlayTemp();
        e.preventDefault();
      }
    });

    // -------------------
    // เริ่มต้น
    // -------------------
    window.addEventListener('load', function(){
      buildChannelListUI();
      applyChannel(0); // เริ่ม CH1
      showOverlayTemp();
      attachFirstTapFullscreen();  // ให้ tap ครั้งแรกขอ fullscreen

      // เปิดใช้งาน swipe ซ้าย/ขวา เปลี่ยนช่อง (เฉพาะอุปกรณ์ touch)
      document.addEventListener('touchstart', handleTouchStart, { passive: true });
      document.addEventListener('touchend', handleTouchEnd, { passive: true });
    });
  })();
  </script>
</body>
</html>
